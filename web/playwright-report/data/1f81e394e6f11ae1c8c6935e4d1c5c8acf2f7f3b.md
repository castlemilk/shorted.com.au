# Test info

- Name: Algolia Search Functionality >> should return results quickly (< 500ms perceived)
- Location: /Users/benebsworth/projects/shorted/web/e2e/algolia-search.spec.ts:79:3

# Error details

```
Error: locator.fill: Test timeout of 30000ms exceeded.
Call log:
  - waiting for locator('input[placeholder*="Search"], input[type="search"]').first()

    at /Users/benebsworth/projects/shorted/web/e2e/algolia-search.spec.ts:89:23
```

# Page snapshot

```yaml
- img
- text: Preview Environment • This is a preview deployment with test data
- button "Dismiss banner":
  - img
- img
- text: "Development Mode • API: http://localhost:9091"
- banner:
  - link "Shorted":
    - /url: /
    - img
    - text: Shorted
  - navigation:
    - link "about":
      - /url: /about
    - link "blog":
      - /url: /blog
  - button "Sign in"
  - navigation:
    - button "Toggle theme":
      - img
      - img
      - text: Toggle theme
- img "Shorted Logo"
- heading "Welcome to Shorted" [level=3]
- paragraph: Sign in to access advanced features and insights
- button "Continue with Google":
  - img
  - text: Continue with Google
- text: Or continue with Email
- textbox "Email"
- text: Password
- textbox "Password"
- button "Sign in"
- text: By signing in, you agree to our
- link "Terms of Service":
  - /url: /terms
- text: and
- link "Privacy Policy":
  - /url: /terms
- contentinfo:
  - paragraph:
    - text: Built with ❤️ by
    - link "castlemilk":
      - /url: https://twitter.com/shorted
  - img
  - text: v0.2.2-548-gc860d799-dirty
  - link "roadmap":
    - /url: /roadmap
    - img
    - text: roadmap
  - link "terms":
    - /url: /terms
    - img
    - text: terms
- alert
```

# Test source

```ts
   1 | import { test, expect, type Page } from "@playwright/test";
   2 |
   3 | /**
   4 |  * Algolia Search & Logo Display Tests
   5 |  *
   6 |  * These tests verify:
   7 |  * 1. Algolia search functionality (typo tolerance, elastic search)
   8 |  * 2. Logo display in search results and stock pages
   9 |  * 3. Search performance characteristics
   10 |  *
   11 |  * Regression prevention for:
   12 |  * - Missing logos on search results
   13 |  * - Missing logos on stock detail pages
   14 |  * - Search not finding stocks by description (e.g., "copper mining")
   15 |  * - Typo tolerance not working (e.g., "commwealth" → "Commonwealth")
   16 |  *
   17 |  * Note: /stocks is a protected route, so UI search tests are skipped
   18 |  * unless running with authentication. API tests always run.
   19 |  */
   20 |
   21 | // Check if we should skip UI tests that require auth
   22 | const skipAuthTests = !process.env.RUN_AUTH_TESTS;
   23 |
   24 | test.describe("Algolia Search Functionality", () => {
   25 |   // Skip UI tests if no auth - they will run in authenticated project
   26 |   test.skip(() => skipAuthTests, "Skipping - requires authentication");
   27 |
   28 |   test.beforeEach(async ({ page }) => {
   29 |     await page.goto("/stocks");
   30 |     await page.waitForLoadState("networkidle");
   31 |   });
   32 |
   33 |   test("should find stocks with typo tolerance", async ({ page }) => {
   34 |     const searchInput = page.locator(
   35 |       'input[placeholder*="Search"], input[type="search"]',
   36 |     ).first();
   37 |
   38 |     // Type with a typo: "commwealth" instead of "commonwealth"
   39 |     await searchInput.fill("commwealth");
   40 |     await searchInput.press("Enter");
   41 |
   42 |     // Wait for search results
   43 |     await page.waitForTimeout(1500);
   44 |
   45 |     // Should find Commonwealth Bank despite typo
   46 |     const pageContent = await page.content();
   47 |     const foundCBA =
   48 |       pageContent.toLowerCase().includes("commonwealth") ||
   49 |       pageContent.toLowerCase().includes("cba");
   50 |
   51 |     expect(foundCBA).toBeTruthy();
   52 |   });
   53 |
   54 |   test("should search across company descriptions (elastic search)", async ({
   55 |     page,
   56 |   }) => {
   57 |     const searchInput = page.locator(
   58 |       'input[placeholder*="Search"], input[type="search"]',
   59 |     ).first();
   60 |
   61 |     // Search for "copper" which should match companies with copper in their description
   62 |     await searchInput.fill("copper");
   63 |     await searchInput.press("Enter");
   64 |
   65 |     // Wait for search results
   66 |     await page.waitForTimeout(1500);
   67 |
   68 |     // Should find copper-related stocks (29M, CSC, etc.)
   69 |     const pageContent = await page.content();
   70 |     const foundCopperStock =
   71 |       pageContent.includes("29M") ||
   72 |       pageContent.includes("CSC") ||
   73 |       pageContent.toLowerCase().includes("copper") ||
   74 |       pageContent.includes("IGO");
   75 |
   76 |     expect(foundCopperStock).toBeTruthy();
   77 |   });
   78 |
   79 |   test("should return results quickly (< 500ms perceived)", async ({
   80 |     page,
   81 |   }) => {
   82 |     const searchInput = page.locator(
   83 |       'input[placeholder*="Search"], input[type="search"]',
   84 |     ).first();
   85 |
   86 |     // Measure search response time
   87 |     const startTime = Date.now();
   88 |
>  89 |     await searchInput.fill("BHP");
      |                       ^ Error: locator.fill: Test timeout of 30000ms exceeded.
   90 |     await searchInput.press("Enter");
   91 |
   92 |     // Wait for results to appear
   93 |     await page.waitForSelector(
   94 |       '[class*="search-result"], [class*="grid"], table tbody tr',
   95 |       { timeout: 5000 },
   96 |     );
   97 |
   98 |     const endTime = Date.now();
   99 |     const searchTime = endTime - startTime;
  100 |
  101 |     console.log(`Search completed in ${searchTime}ms`);
  102 |
  103 |     // Should complete in under 3 seconds (generous for network latency)
  104 |     expect(searchTime).toBeLessThan(3000);
  105 |   });
  106 |
  107 |   test("should handle empty search gracefully", async ({ page }) => {
  108 |     const searchInput = page.locator(
  109 |       'input[placeholder*="Search"], input[type="search"]',
  110 |     ).first();
  111 |
  112 |     // Clear any existing text and try to search
  113 |     await searchInput.clear();
  114 |
  115 |     // Verify input is empty
  116 |     await expect(searchInput).toHaveValue("");
  117 |
  118 |     // Page should still be functional
  119 |     await expect(page.locator("body")).toBeVisible();
  120 |   });
  121 |
  122 |   test("should search by stock code exactly", async ({ page }) => {
  123 |     const searchInput = page.locator(
  124 |       'input[placeholder*="Search"], input[type="search"]',
  125 |     ).first();
  126 |
  127 |     // Search for exact stock code
  128 |     await searchInput.fill("BHP");
  129 |     await searchInput.press("Enter");
  130 |
  131 |     await page.waitForTimeout(1500);
  132 |
  133 |     // BHP should be in results
  134 |     const pageContent = await page.content();
  135 |     expect(pageContent).toContain("BHP");
  136 |   });
  137 |
  138 |   test("should search by company name", async ({ page }) => {
  139 |     const searchInput = page.locator(
  140 |       'input[placeholder*="Search"], input[type="search"]',
  141 |     ).first();
  142 |
  143 |     // Search for company name
  144 |     await searchInput.fill("Woolworths");
  145 |     await searchInput.press("Enter");
  146 |
  147 |     await page.waitForTimeout(1500);
  148 |
  149 |     // Should find Woolworths (WOW)
  150 |     const pageContent = await page.content();
  151 |     const foundWoolworths =
  152 |       pageContent.includes("WOW") ||
  153 |       pageContent.toLowerCase().includes("woolworth");
  154 |
  155 |     expect(foundWoolworths).toBeTruthy();
  156 |   });
  157 | });
  158 |
  159 | test.describe("Logo Display in Search Results", () => {
  160 |   // Skip UI tests if no auth - they will run in authenticated project
  161 |   test.skip(() => skipAuthTests, "Skipping - requires authentication");
  162 |
  163 |   test.beforeEach(async ({ page }) => {
  164 |     await page.goto("/stocks");
  165 |     await page.waitForLoadState("networkidle");
  166 |   });
  167 |
  168 |   test("should display logos for major stocks in search dropdown", async ({
  169 |     page,
  170 |   }) => {
  171 |     const searchInput = page.locator(
  172 |       'input[placeholder*="Search"], input[type="search"]',
  173 |     ).first();
  174 |
  175 |     // Search for a major stock that should have a logo
  176 |     await searchInput.fill("BHP");
  177 |
  178 |     // Wait for dropdown to appear
  179 |     await page.waitForTimeout(1000);
  180 |
  181 |     // Check for logo in dropdown (img with src containing storage.googleapis.com)
  182 |     const dropdownLogo = page.locator(
  183 |       'img[src*="storage.googleapis.com"], img[src*="shorted-company-logos"]',
  184 |     );
  185 |
  186 |     const logoCount = await dropdownLogo.count();
  187 |
  188 |     // If dropdown shows, it should have logos
  189 |     if (logoCount > 0) {
```