syntax = "proto3";

package stocks.v1alpha1;

option go_package = "github.com/castlemilk/shorted.com.au/services/gen/proto/go/stocks/v1alpha1;stocksv1alpha1";

import "google/protobuf/timestamp.proto";

// A Stock represents a single stock's metadata.
message Stock {
  string product_code = 1; // The stock code, e.g., "CBA", "ZIP", "PLS".
  string name = 2;         // The full name of the stock.
  float total_product_in_issue = 3;
  float reported_short_positions = 4;
  float percentage_shorted = 5;
  string industry = 6;
  repeated string tags = 7;
  string logo_url = 8;
  // TODO(castlemilk): add more metadata here as needed
  }
  
// TimeSeriesData represents time series data for a stock.
message TimeSeriesData {
  string product_code = 1;                        // The stock code.
  string name = 3;
  double latest_short_position = 4;                // The latest short position.
  repeated TimeSeriesPoint points = 10;            // The time series points.
  TimeSeriesPoint max = 11;                        // The maximum short position in the range
  TimeSeriesPoint min = 12;                        // The minimum short position in the range

}
  
// TimeSeriesPoint represents a single point in time for the time series data.
message TimeSeriesPoint {
  google.protobuf.Timestamp timestamp = 1;        // The point in time.
  double short_position = 2;                      // The short position at this point in time.
}

/**
Table "public.metadata"
      Column       | Type | Collation | Nullable | Default 
-------------------+------+-----------+----------+---------
 company_name      | text |           |          | 
 address           | text |           |          | 
 summary           | text |           |          | 
 details           | text |           |          | 
 website           | text |           |          | 
 stock_code        | text |           |          | 
 links             | text |           |          | 
 images            | text |           |          | 
 company_logo_link | text |           |          | 
 gcsUrl            | text |           |          | 
*/
message StockDetails {
  string product_code = 1;
  string company_name = 2;
  string industry = 3;
  string address = 4;
  string summary = 5;
  string details = 6;
  string website = 7;
  string gcs_url = 8;
  repeated string tags = 9;
  string enhanced_summary = 10;
  string company_history = 11;
  repeated CompanyPerson key_people = 12;
  repeated FinancialReport financial_reports = 13;
  string competitive_advantages = 14;
  repeated string risk_factors = 15;
  string recent_developments = 16;
  SocialMediaLinks social_media_links = 17;
  string enrichment_status = 18;
  google.protobuf.Timestamp enrichment_date = 19;
  string enrichment_error = 20;
  FinancialStatements financial_statements = 21;
}

message CompanyPerson {
  string name = 1;
  string role = 2;
  string bio = 3;
}

message FinancialReport {
  string url = 1;
  string title = 2;
  string type = 3;
  string date = 4;
  string source = 5;
  string gcs_url = 6;
}

message SocialMediaLinks {
  string twitter = 1;
  string linkedin = 2;
  string facebook = 3;
  string youtube = 4;
  string website = 5;
}

message FinancialStatements {
  bool success = 1;
  FinancialStatementSet annual = 2;
  FinancialStatementSet quarterly = 3;
  FinancialStatementsInfo info = 4;
  string error = 5;
}

message FinancialStatementSet {
  map<string, StatementValues> income_statement = 1;
  map<string, StatementValues> balance_sheet = 2;
  map<string, StatementValues> cash_flow = 3;
}

message StatementValues {
  map<string, double> metrics = 1;
}

message FinancialStatementsInfo {
  double market_cap = 1;
  double current_price = 2;
  double pe_ratio = 3;
  double eps = 4;
  double dividend_yield = 5;
  double beta = 6;
  double week_52_high = 7;
  double week_52_low = 8;
  double volume = 9;
  int64 employee_count = 10;
  string sector = 11;
  string industry = 12;
}


message IndustryTreeMap {
  // indstries that a stock will belond to
  repeated string industries = 1;
  repeated TreemapShortPosition stocks = 2;
}

message TreemapShortPosition {
  string industry = 1;
  string product_code = 2;
  double short_position = 3;
}
